<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - Sky Cloud</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex">

  <!-- Sidebar -->
  <aside class="w-64 bg-gray-800 p-6 flex flex-col space-y-6">

    <h2 class="text-xl font-semibold mb-4">Folders</h2>

    <!-- Create Folder Form -->
    <form action="/dashboard/folders" method="POST" class="mb-6">
      <label for="folderName" class="block text-sm mb-1">New Folder</label>
      <input 
        type="text" 
        name="name" 
        id="folderName" 
        placeholder="Folder name" 
        required
        class="w-full px-3 py-2 rounded bg-gray-700 border border-gray-600 text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2"
      />
      <button 
        type="submit"
        class="w-full bg-blue-600 hover:bg-blue-700 py-2 rounded text-white font-semibold transition duration-200"
      >
        Create Folder
      </button>
    </form>

    <h3 class="text-lg font-semibold mb-2">Your Folders</h3>
    <ul class="flex flex-col space-y-1 max-h-64 overflow-auto">
      <% if (folders.length === 0) { %>
        <li class="text-gray-400 italic text-sm">No folders created</li>
      <% } else { %>
        <% folders.forEach(folder => { %>
          <li class="px-2 py-1 rounded hover:bg-gray-700 cursor-default">
            <%= folder.name %>
          </li>
        <% }) %>
      <% } %>
    </ul>

  </aside>

  <!-- Main content -->
  <main class="flex-1 p-6 overflow-auto">

    <h1 class="text-3xl font-bold mb-6">Dashboard</h1>

    <!-- Upload File Form -->
    <section class="mb-10 max-w-lg">
      <h2 class="text-xl font-semibold mb-3">Upload File</h2>
      <form action="/dashboard/upload" method="POST" enctype="multipart/form-data" class="space-y-4">
        <div>
          <label for="file" class="block mb-1 text-sm">Choose file</label>
          <input 
            type="file" 
            name="file" 
            id="file" 
            required
            class="w-full text-gray-100 bg-gray-700 border border-gray-600 rounded px-3 py-2"
          />
        </div>

        <div>
          <label for="folderId" class="block mb-1 text-sm">Select Folder (optional)</label>
          <select 
            name="folderId" 
            id="folderId" 
            class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-gray-100"
          >
            <option value="">No folder (default)</option>
            <% folders.forEach(folder => { %>
              <option value="<%= folder.id %>"><%= folder.name %></option>
            <% }) %>
          </select>
        </div>

        <button 
          type="submit" 
          class="bg-green-600 hover:bg-green-700 text-white py-2 rounded font-semibold transition duration-200 w-full"
        >
          Upload
        </button>
      </form>
    </section>

    <!-- Files List -->
    <section>
      <h2 class="text-xl font-semibold mb-4">Your Files</h2>

      <% if (files.length === 0) { %>
        <p class="text-gray-400 italic">No files uploaded yet.</p>
      <% } else { %>
        <div class="space-y-6">

          <% folders.forEach(folder => { %>
            <div>
              <h3 class="text-lg font-semibold mb-2 border-b border-gray-700 pb-1"><%= folder.name %></h3>
              <ul class="list-disc pl-5 space-y-1">
                <% const folderFiles = files.filter(f => f.folderId === folder.id); %>
                <% if (folderFiles.length === 0) { %>
                  <li class="text-gray-400 italic">No files in this folder</li>
                <% } else { %>
                  <% folderFiles.forEach(file => { %>
                    <li>
                      <strong><%= file.originalName %></strong> - <%= (file.size / 1024).toFixed(1) %> KB - <%= new Date(file.uploadedAt).toLocaleString() %>
                    </li>
                  <% }) %>
                <% } %>
              </ul>
            </div>
          <% }) %>

          <!-- Files without folder -->
          <div class="mt-6">
            <h3 class="text-lg font-semibold mb-2 border-b border-gray-700 pb-1">Unsorted Files</h3>
            <ul class="list-disc pl-5 space-y-1">
              <% const noFolderFiles = files.filter(f => !f.folderId); %>
              <% if (noFolderFiles.length === 0) { %>
                <li class="text-gray-400 italic">No unsorted files</li>
              <% } else { %>
                <% noFolderFiles.forEach(file => { %>
                  <li>
                    <strong><%= file.originalName %></strong> - <%= (file.size / 1024).toFixed(1) %> KB - <%= new Date(file.uploadedAt).toLocaleString() %>
                  </li>
                <% }) %>
              <% } %>
            </ul>
          </div>

        </div>
      <% } %>
    </section>

  </main>

</body>
</html>
